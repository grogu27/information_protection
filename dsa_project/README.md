# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ11  
## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ–¥–ø–∏—Å–∏ FIPS 186 (DSA) –Ω–∞ C++

–î–∞–Ω–Ω–∞—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ—Å–≤—è—â–µ–Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ–¥–ø–∏—Å–∏
–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º **FIPS 186** (DSA ‚Äî Digital Signature Algorithm).
–¶–µ–ª—å —Ä–∞–±–æ—Ç—ã ‚Äî –Ω–∞–ø–∏—Å–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É –Ω–∞ C++, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç:

- –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á–∏ DSA;
- –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π —Ñ–∞–π–ª;
- —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ–¥–ø–∏—Å—å –≤–º–µ—Å—Ç–µ —Å —Ñ–∞–π–ª–æ–º –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ;
- –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø–æ–¥–ø–∏—Å–∏.

–î–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫.
–í –ø—Ä–æ–µ–∫—Ç–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è **SHA-256** –∏–∑ –Ω–∞–±–æ—Ä–∞ OpenSSL, —á—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é:
> ¬´—Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–µ —Å–ª–∞–±–µ–µ MD5¬ª.

---

# üìò –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å–Ω–æ–≤—ã

–ê–ª–≥–æ—Ä–∏—Ç–º DSA –æ—Å–Ω–æ–≤—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏—Ö —ç—Ç–∞–ø–∞—Ö:

1. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ p, q, g**  
   –≠—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–æ—Ä–º–∏—Ä—É—é—Ç –¥–æ–º–µ–Ω DSA.

2. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π**
   - –ó–∞–∫—Ä—ã—Ç—ã–π –∫–ª—é—á: —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ `x`  
   - –û—Ç–∫—Ä—ã—Ç—ã–π –∫–ª—é—á: `y = g^x mod p`

3. **–ü–æ–¥–ø–∏—Å—å —Å–æ–æ–±—â–µ–Ω–∏—è**
   - –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è —Ö–µ—à —Å–æ–æ–±—â–µ–Ω–∏—è: `H = SHA-256(message)`
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ `k`
   - –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å—å `(r, s)`

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏**
   - –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Ö–µ—à
   - –ü—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è, –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º

–í—Å–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ OpenSSL.

---

# üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
project/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.cpp       ‚Äî CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥)
‚îÇ   ‚îú‚îÄ‚îÄ crypto.cpp     ‚Äî –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ DSA: –∫–ª—é—á–∏, –ø–æ–¥–ø–∏—Å—å, –ø—Ä–æ–≤–µ—Ä–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ crypto.h
‚îÇ   ‚îú‚îÄ‚îÄ utils.cpp      ‚Äî —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏ (—á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å)
‚îÇ   ‚îî‚îÄ‚îÄ utils.h
‚îú‚îÄ‚îÄ Makefile           ‚Äî —Å–±–æ—Ä–∫–∞, –∫–æ–º–∞–Ω–¥—ã genkeys/sign/verify
‚îú‚îÄ‚îÄ build.sh           ‚Äî –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —Å–±–æ—Ä–∫–∏
‚îú‚îÄ‚îÄ keys/              ‚Äî —Å—é–¥–∞ –∫–ª–∞–¥—É—Ç—Å—è –∫–ª—é—á–∏
‚îî‚îÄ‚îÄ bin/               ‚Äî –∏—Ç–æ–≥–æ–≤—ã–π –±–∏–Ω–∞—Ä–Ω–∏–∫ fips186-dsa
```

---

# üß© –û–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

## üîê –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π

–í `crypto.cpp` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è:

```cpp
bool generate_dsa_keypair(const std::string& output_dir,
                          const std::string& prefix,
                          int bits);
```

–û–Ω–∞:

1. —Å–æ–∑–¥–∞—ë—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç DSA (OpenSSL);
2. –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã p, q, g;
3. –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–ª—é—á–∏;
4. —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ PEM-—Ñ–∞–π–ª—ã.

–†–µ–∑—É–ª—å—Ç–∞—Ç:

```
keys/dsa_private.pem
keys/dsa_public.pem
```

---

## ‚úç –ü–æ–¥–ø–∏—Å—å —Ñ–∞–π–ª–∞

–§—É–Ω–∫—Ü–∏—è `sign_file()`:

1. –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á;
2. —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–∞;
3. –≤—ã—á–∏—Å–ª—è–µ—Ç SHA-256;
4. —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –ø–æ–¥–ø–∏—Å—å —Å –ø–æ–º–æ—â—å—é `EVP_DigestSign*`;
5. —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–¥–ø–∏—Å—å –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª `<–∏–º—è>.sig`
   –∏–ª–∏, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω `--embed`, –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ–¥–ø–∏—Å—å –≤–Ω—É—Ç—Ä—å —Ñ–∞–π–ª–∞.

---

## ‚úî –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏

–§—É–Ω–∫—Ü–∏—è `verify_file_signature()`:

1. –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á;
2. —á–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª –∏ –ø–æ–¥–ø–∏—Å—å;
3. –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤—ã—á–∏—Å–ª—è–µ—Ç SHA-256;
4. –≤—ã–∑—ã–≤–∞–µ—Ç `EVP_DigestVerify` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ø–æ–¥–ø–∏—Å–∏.

–†–µ–∑—É–ª—å—Ç–∞—Ç:

```
Signature is VALID.
```
–∏–ª–∏
```
Signature is INVALID.
```

---

# üõ† –ö–æ–º–∞–Ω–¥–Ω–∞—è —É—Ç–∏–ª–∏—Ç–∞

–§–∞–π–ª `main.cpp` —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:

```
fips186-dsa genkey  -o keys/ -b 2048
fips186-dsa sign    -k key.pem -i file [-o sig]
fips186-dsa verify  -k pub.pem -i file -s sig
```

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| `-o` | –∫–∞—Ç–∞–ª–æ–≥ –¥–ª—è –∫–ª—é—á–µ–π –∏–ª–∏ –∏–º—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ |
| `-b` | –¥–ª–∏–Ω–∞ –∫–ª—é—á–∞ (1024‚Äì3072 –±–∏—Ç) |
| `-k` | –ø—É—Ç—å –∫ –æ—Ç–∫—Ä—ã—Ç–æ–º—É/–∑–∞–∫—Ä—ã—Ç–æ–º—É –∫–ª—é—á—É |
| `-i` | –≤—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª |
| `-s` | —Ñ–∞–π–ª –ø–æ–¥–ø–∏—Å–∏ |
| `--embed` | –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∏ –≤ —Ñ–∞–π–ª |

---

# üß™ Makefile

Makefile —Å–æ–∑–¥–∞—ë—Ç –ø–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

### –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
make
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π:

```bash
make genkeys
```

### –ü–æ–¥–ø–∏—Å—å —Ñ–∞–π–ª–∞:

```bash
make sign FILE=data.bin
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏:

```bash
make verify FILE=data.bin
```

Makefile –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `bin/` –∏ `keys/`.

---

# üßæ –ü—Ä–∏–º–µ—Ä –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

```
$ make genkeys
[+] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π...
OK: keys/dsa_private.pem
OK: keys/dsa_public.pem

$ make sign FILE=test.txt
–ü–æ–¥–ø–∏—Å–∞–Ω–æ: test.txt.sig

$ make verify FILE=test.txt
Signature is VALID.
```

---

# üìú –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í —Ö–æ–¥–µ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã –±—ã–ª —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω:

- –∞–ª–≥–æ—Ä–∏—Ç–º DSA (FIPS 186);
- –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –∫–ª—é—á–µ–π;
- –ø–æ–¥–ø–∏—Å—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º SHA-256;
- –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏;
- –∫–æ–Ω—Å–æ–ª—å–Ω–∞—è —É—Ç–∏–ª–∏—Ç–∞ –Ω–∞ C++;
- Makefile –∏ build.sh;
- –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞.

–ü—Ä–æ–≥—Ä–∞–º–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã.
